<app-topbar [isNewMessageMode]="isNewMessageMode()" [showMobileBack]="isMobile() && activeMobileView() !== 'sidebar'"
  (back)="backOneLevel()">
</app-topbar>


<section class="shell">

  <!-- ========== WORKSPACE SIDEBAR - IMMER SICHTBAR (auÃŸer Mobile) ========== -->
  @if (!isMobile() || activeMobileView() === 'sidebar') {
  <app-workspace-sidebar 
    [isMobile]="isMobile()" 
    [currentUserUid]="currentUserUid" 
    (newMessage)="openNewMessage()"
    (mobileViewChange)="activeMobileView.set($event)"
    (workspaceToggle)="onWorkspaceToggle($event)">
  </app-workspace-sidebar>
  }
  <!-- ========== END WORKSPACE SIDEBAR ========== -->

  <!-- ========== VIEW COMPONENT - MIT SMOOTH ANIMATION ========== -->
  @if (!isMobile()) {
    <!-- Desktop: Immer im DOM, nur hidden class -->
    <app-view 
      [currentUserUid]="currentUserUid" 
      (openThread)="onOpenThread()"
      [class.hidden]="!shouldShowView()">
    </app-view>
  } @else if (activeMobileView() === 'chat' || activeMobileView() === 'new-message') {
    <!-- Mobile: Nur rendern wenn aktiv -->
    <app-view 
      [currentUserUid]="currentUserUid" 
      (openThread)="onOpenThread()">
    </app-view>
  }
  <!-- ========== END VIEW COMPONENT ========== -->


  <!-- ========== THREAD MENU ========== -->
  @if (!isMobile() || activeMobileView() === 'thread') {
  <app-thread-menu 
    [currentUserUid]="currentUserUid"
    [class.thread-open]="threadService.isOpen()"
    [class.full-width]="!shouldShowView()">
  </app-thread-menu>
  }
  <!-- ========== END THREAD MENU ========== -->

</section>

@if (isMobile() && activeMobileView() === 'sidebar') {
<button class="resp-fab" matFab (click)="openNewMessage()">
  <img src="/assets/icons/global/edit_square_white.svg" alt="">
</button>
}