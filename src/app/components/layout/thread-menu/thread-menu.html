<section *ngIf="threadService.isOpen()">

  <!-- HEADER - Exakt wie View -->
  <header class="dm-header dm-header-small">
    <div style="width: 100%;">
      <div id="header-left" style="display: flex; align-items: center; gap: 8px;">
        <h2>Thread</h2>
        <span class="channel-name"># {{ threadService.channelName() }}</span>
      </div>
    </div>

    <!-- Close-Button -->
    <button class="close-btn" (click)="closeThread()" type="button">
      <img src="/assets/icons/global/close.svg" alt="Schließen">
    </button>
  </header>

  <!-- CHAT CONTAINER - Exakt wie View -->
  <div id="chat-container-new">

    <!-- MESSAGES SCROLL - Exakt wie View -->
    <div class="messages-scroll">

      <!-- PARENT MESSAGE - Mit externalMessages ABER mit channel/conversationId für Actions -->
      <div *ngIf="threadService.parentMessage() as parent">
        <app-message
          [contextType]="threadService.contextType()"
          [currentUserUid]="currentUserUid"
          [externalMessages]="[parent]"
          [channel]="threadService.contextType() === 'channel' ? getChannelById(threadService.contextId()) : undefined"
          [conversationId]="threadService.contextType() === 'conversation' ? threadService.contextId() : null">
        </app-message>
      </div>

      <!-- SEPARATOR -->
      <div class="thread-separator">
        <span>
          {{ threadService.threadMessages().length }} 
          {{ threadService.threadMessages().length === 1 ? 'Antwort' : 'Antworten' }}
        </span>
      </div>

      <!-- THREAD MESSAGES - Nutzt externalMessages -->
      <div class="thread-messages-section">
        
        <div *ngIf="threadService.threadMessages().length === 0" class="thread-empty">
          <p>Noch keine Antworten. Sei der Erste!</p>
        </div>

        <app-message
          *ngIf="threadService.threadMessages().length > 0"
          [contextType]="threadService.contextType()"
          [currentUserUid]="currentUserUid"
          [externalMessages]="threadService.threadMessages()"
          [isThreadContext]="true"
          [threadParentMessageId]="threadService.parentMessage()?.id"
          [channel]="threadService.contextType() === 'channel' ? getChannelById(threadService.contextId()) : undefined"
          [conversationId]="threadService.contextType() === 'conversation' ? threadService.contextId() : null">
        </app-message>

      </div>

    </div>

    <!-- MESSAGE INPUT - Exakt wie View -->
    <app-message-input
      [currentUserUid]="currentUserUid"
      [contextType]="'thread'"
      [placeholderText]="'Antworten...'"
      (threadMessageSent)="onThreadMessageSent($event)">
    </app-message-input>

  </div>

</section>